-- ServerScript in ServerScriptService

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local ChatService = game:GetService("Chat")
local Players = game:GetService("Players")

-- Create RemoteEvent in ReplicatedStorage if it doesn't exist
local honoredEvent = ReplicatedStorage:FindFirstChild("HonoredEvent")
if not honoredEvent then
    honoredEvent = Instance.new("RemoteEvent")
    honoredEvent.Name = "HonoredEvent"
    honoredEvent.Parent = ReplicatedStorage
end

-- Function to create UI and handle button press
local function createUI(player)
    -- Create ScreenGui and button for the player
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = player.PlayerGui
    screenGui.Name = "HonoredOneUI"

    local button = Instance.new("TextButton")
    button.Parent = screenGui
    button.Size = UDim2.new(0, 200, 0, 50)
    button.Position = UDim2.new(0.5, -100, 0.5, -25)
    button.Text = "The Honored One"
    button.TextSize = 20

    -- Function to handle button click event
    button.MouseButton1Click:Connect(function()
        honoredEvent:FireServer(player)  -- Fire the event to the server when the button is clicked
    end)
end

-- Function to honor the player (lift and flat in the air)
local function honorPlayer(player)
    -- Ensure the player has a character and humanoid
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        local humanoid = player.Character.Humanoid
        local rootPart = player.Character:WaitForChild("HumanoidRootPart")

        -- Make sure the character is not already being honored
        if not player.Character:FindFirstChild("HonoredEffect") then
            local honoredEffect = Instance.new("BoolValue")
            honoredEffect.Name = "HonoredEffect"
            honoredEffect.Parent = player.Character

            -- Set up the player's pose and platform stand (force them to "float")
            humanoid.Sit = false
            humanoid.PlatformStand = true  -- Disable character's movement while "floating"

            -- Lay the player flat (rotate them to lie on their back)
            rootPart.CFrame = rootPart.CFrame * CFrame.Angles(math.rad(90), 0, 0)
            
            -- Lift the player into the air
            local originalPosition = rootPart.Position
            local targetPosition = originalPosition + Vector3.new(0, 10, 0)  -- Raise 10 studs up

            -- Tween the player upwards
            TweenService:Create(rootPart, TweenInfo.new(1), {Position = targetPosition}):Play()

            -- Wait a bit before saying the message
            wait(1)

            -- Player says the message
            ChatService:Chat(player.Character, "I alone am the honored one!", Enum.ChatColor.Red)

            -- Wait for 5 seconds while the player is floating
            wait(5)

            -- Bring the player back down
            TweenService:Create(rootPart, TweenInfo.new(1), {Position = originalPosition}):Play()

            -- Reset the sitting and platform stand
            wait(1)
            humanoid.PlatformStand = false
            rootPart.CFrame = rootPart.CFrame  -- Reset to normal stance

            -- Clean up the effect
            honoredEffect:Destroy()
        end
    end
end

-- Listen for the event to trigger the honor effect
honoredEvent.OnServerEvent:Connect(honorPlayer)

-- Create UI for each player that joins
Players.PlayerAdded:Connect(function(player)
    createUI(player)
end)
